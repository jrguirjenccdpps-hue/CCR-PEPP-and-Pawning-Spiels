<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CCR PEPP & Pawning Spiels</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Segoe UI;background:#f0fdf4;padding:20px;color:#064e3b}
h2{text-align:center;margin-bottom:20px}
.tabs{display:flex;gap:10px;margin-bottom:10px}
.tab{flex:1;padding:10px;text-align:center;border-radius:10px;cursor:pointer;background:#e5f7ed;font-weight:bold;transition:0.2s}
.tab.active{background:#059669;color:#fff}
#tabContent{min-height:300px}
#search{width:100%;padding:12px;border-radius:10px;border:1px solid #a7f3d0;margin-bottom:10px}
.loader{display:none;text-align:center;margin:10px 0}
.spinner{width:36px;height:36px;border:4px solid #d1fae5;border-top:4px solid #059669;border-radius:50%;animation:spin 1s linear infinite;margin:auto}
.loader-text{margin-top:6px;font-size:13px}
@keyframes spin{to{transform:rotate(360deg)}}
.card{background:#fff;border-radius:12px;padding:15px;margin-bottom:12px;box-shadow:0 4px 8px rgba(0,0,0,0.08)}
.logout{position:fixed;top:10px;right:10px;background:#dc2626;color:#fff;border:none;padding:6px 10px;border-radius:6px;display:none;cursor:pointer}
#loginOverlay{position:fixed;inset:0;background:rgba(0,0,0,0.3);display:flex;align-items:center;justify-content:center;opacity:0;transition:0.3s;pointer-events:none}
#loginBox{background:#fff;padding:25px;border-radius:12px;width:300px;transform:translateY(-30px);transition:0.3s}
#loginOverlay.show{opacity:1;pointer-events:auto}
#loginOverlay.show #loginBox{transform:translateY(0)}
</style>
</head>
<body>

<button class="logout" onclick="logout()">Logout</button>
<h2>CCR PEPP & Pawning Spiels</h2>

<div class="tabs">
  <div class="tab active" data-tab="search">Search Spiels</div>
  <div class="tab" data-tab="money">Money Changer</div>
  <div class="tab" data-tab="gold">Palawan Gold</div>
  <div class="tab" data-tab="memo">Memo & Advisory</div>
</div>

<div id="tabContent">
  <!-- Search -->
  <div id="searchTab">
    <input type="text" id="search" placeholder="Search Spiel Name...">
    <div class="loader" id="loader">
      <div class="spinner"></div>
      <div class="loader-text">Searching spiels...</div>
    </div>
    <div id="results" style="max-height:600px; overflow-y:auto;"></div>
  </div>

  <iframe id="moneyTab" src="https://jrguirjenccdpps-hue.github.io/Money-Changer/"
    style="width:100%; height:500px; display:none; border:none;"></iframe>

  <iframe id="goldTab" src="https://jrguirjenccdpps-hue.github.io/Palawan-Gold-Price/"
    style="width:100%; height:500px; display:none; border:none;"></iframe>

<!-- Memo & Advisory -->
  <div id="memoTab" style="display:none;">
    <!-- PDF Toolbar -->
    <div id="pdfToolbar">
      <div id="pdfTitle"></div>
      <div>
        <button onclick="closePDF()">Close</button>
        <button onclick="zoomPDF(1.2)">Zoom In</button>
        <button onclick="zoomPDF(0.8)">Zoom Out</button>
      </div>
    </div>
    <!-- PDF Viewer -->
    <iframe id="pdfViewer"></iframe>

    <!-- Memo Cards -->
    <div class="memo-card" onclick="showPDF('https://drive.google.com/file/d/1k-IFfleDsUp4SGbqmzLWN6HcyRS37sbr/preview','Annex C â€“ Guidelines for Authorized Representatives')">
      <div class="memo-icon">ðŸ“„</div>
      <div>
        <div class="memo-title">Annex C â€“ Guidelines for Authorized Representatives</div>
        <div class="memo-sub">Effective Sept 1, 2023</div>
      </div>
    </div>

    <div class="memo-card" onclick="showPDF('https://drive.google.com/file/d/1xCpK6LulqyFfW1wC6U5rcuy6Alz0RaJ9/preview','Annex D â€“ ID Requirements')">
      <div class="memo-icon">ðŸ“„</div>
      <div>
        <div class="memo-title">Annex D â€“ ID Requirements</div>
        <div class="memo-sub">Effective June 1, 2023</div>
      </div>
    </div>
<!-- LOGIN -->
<div id="loginOverlay">
  <div id="loginBox">
    <h3>Login</h3>
    <input id="user" placeholder="Username" style="width:100%;padding:10px;margin-bottom:6px">
    <input id="pass" type="password" placeholder="Password" style="width:100%;padding:10px;margin-bottom:10px">
    <button onclick="loginUser()" style="width:100%;padding:10px;background:#059669;color:#fff;border:none">Login</button>
    <p id="msg" style="color:red"></p>
  </div>
</div>

<script>
const tabs = document.querySelectorAll(".tab");
const searchTab = document.getElementById("searchTab");
const moneyTab = document.getElementById("moneyTab");
const goldTab = document.getElementById("goldTab");
const memoTab = document.getElementById("memoTab");

tabs.forEach(tab => tab.addEventListener("click",()=>{
  tabs.forEach(t=>t.classList.remove("active")); tab.classList.add("active");
  searchTab.style.display = tab.dataset.tab==="search"?"block":"none";
  moneyTab.style.display = tab.dataset.tab==="money"?"block":"none";
  goldTab.style.display = tab.dataset.tab==="gold"?"block":"none";
  memoTab.style.display = tab.dataset.tab==="memo"?"block":"none";
}));

// LOGIN
const loginOverlay = document.getElementById("loginOverlay");
const userInput = document.getElementById("user");
const passInput = document.getElementById("pass");
const msg = document.getElementById("msg");
let token = localStorage.getItem("token");
let idleTimer;

function showLogin(){ loginOverlay.classList.add("show"); }
function hideLogin(){ loginOverlay.classList.remove("show"); }

function loginUser(){
  fetch("https://script.google.com/macros/s/AKfycbz0ZAPevQzDFxmvuzH985Y7A1eNZj36NSVJNJWoj_Pw94yCCmjQkPEH_-OKK3nHtjE0Fw/exec",{
    method:"POST",
    headers:{ "Content-Type":"application/x-www-form-urlencoded" },
    body:new URLSearchParams({action:"login",username:userInput.value,password:passInput.value})
  })
  .then(r=>r.json())
  .then(d=>{
    if(!d.success){ msg.textContent=d.message; return; }
    localStorage.setItem("token","AUTHORIZED"); token="AUTHORIZED";
    hideLogin(); document.querySelector(".logout").style.display="block"; resetIdle();
  })
  .catch(e=>{ msg.textContent="Network error"; console.error(e); });
}

function logout(){ localStorage.removeItem("token"); location.reload(); }
function resetIdle(){ clearTimeout(idleTimer); idleTimer=setTimeout(logout,5*60*1000); }
["mousemove","keydown","click","scroll"].forEach(e=>document.addEventListener(e,resetIdle));

if(!token){ showLogin(); } else { document.querySelector(".logout").style.display="block"; resetIdle(); }

// SEARCH SPIELS
const searchInput = document.getElementById("search");
const loader = document.getElementById("loader");
const results = document.getElementById("results");
let typingTimer; const TYPING_DELAY=300;

searchInput.addEventListener("input",()=>{ clearTimeout(typingTimer); typingTimer=setTimeout(searchSpiel,TYPING_DELAY); });

function searchSpiel(){
  const q = searchInput.value.trim();
  results.innerHTML=""; if(!q) return;
  loader.style.display="block";

  fetch(`https://script.google.com/macros/s/AKfycbxJK6eIFjO5A1pq9Q_ATtILGoC0EMEgygzu_c6ruYLnxZw9NFbOtNiCgin43SBm_qb0Ow/exec?action=search&q=${encodeURIComponent(q)}`)
    .then(r=>r.json())
    .then(data=>{
      loader.style.display="none";
      if(!data||data.length===0){ results.innerHTML="<p>No results found.</p>"; return; }
      data.forEach(item=>{
        const card=document.createElement("div"); card.className="card";
        card.innerHTML=`<b>${item.spiel}</b><br><br><b>English:</b><br>${item.english}<br><br><b>Tagalog:</b><br>${item.tagalog}`;
        results.appendChild(card);
      });
    })
    .catch(err=>{ loader.style.display="none"; results.innerHTML="<p style='color:red;'>Error fetching spiels.</p>"; console.error(err); });
}
</script>

</body>
</html>
